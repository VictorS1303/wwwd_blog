---
const { src, alt, isDashboardHeader } = Astro.props

import Section from "./Section.astro"
import Image from "../../imags/Image.astro"
import Header from "../../header/Header.astro"
import ControlButtonsContainer from "../../containers/ControlButtonsContainer.astro"

const controlButtons = [
  {
    buttonText: "Edit profile",
    id: "edit_profile_button",
    isDashboardControlButton: true,
  },
  {
    buttonText: "Sign out",
    id: "sign_out_button",
    isDashboardControlButton: true,
  },
  {
    buttonText: "Delete profile",
    id: "delete_profile_button",
    isDashboardControlButton: true,
  },
]
---

<Section class="hero flex flex-col items-center md:items-start">
  <div class="header-and-dashboard-controls-container">
    <Header
      id="dashboard-header"
      class="w-full"
      isDashboardHeader={isDashboardHeader}
    />

    <ControlButtonsContainer buttons={controlButtons} />
  </div>
</Section>

<script>
  import { supabaseClient } from "../../../../js/supabase/supabase_client.js"

  // Run on client-side after page loads
  document.addEventListener("DOMContentLoaded", async () => {
    // Try to get session from Supabase client
    const {
      data: { session },
    } = await supabaseClient.auth.getSession()

    // Fallback to localStorage if session is null
    const localData = JSON.parse(
      localStorage.getItem("sb-lbaohauhywokqbrthwjd-auth-token"),
    )

    const userName =
      session?.user?.user_metadata?.name ||
      localData?.user?.user_metadata?.name ||
      "User"

    // Update header text dynamically
    const headerEl = document.querySelector("#dashboard-header")
    if (headerEl) {
      headerEl.textContent = `Welcome, ${userName}!`
    }
  })
</script>
