---
import Card from "../card/Card.astro"
import { supabaseClient } from "../../../js/supabase/supabase_client"

// Fetch posts from Supabase
const { data: postsData, error: postsError } = await supabaseClient
  .from("blog_posts")
  .select("*")

if (postsError) {
  throw new Error(`Failed to fetch posts: ${postsError.message}`)
}
---

<div class="flex flex-col mt-16">
  <div class="posts-cards-container flex flex-wrap justify-center mt-4">
    {
      postsData && postsData.length > 0 ? (
        postsData.map((post) => (
          <Card
            class="blog-post-card rounded-t-md"
            isBlogPostCard={true}
            headerText={post.post_title}
            src={`${post.post_image}.webp`}
            href={`/blog-posts/${post.post_slug}`}
            textBlockParagraphText={post.post_excerpt}
            buttonText={post.post_card_button_text}
          />
        ))
      ) : (
        <p>No posts available.</p>
      )
    }
  </div>
</div>
