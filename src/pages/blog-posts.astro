---
import { fetchAllPosts } from "../../js/utils/supabase_methods"
import Layout from "../layouts/Layout.astro"
import Hero from "../components/hero/Hero.astro"
import BlogPostsSection from "../components/posts/BlogPostsSection.astro"

const posts = await fetchAllPosts()
const categoryParam = Astro.url.searchParams.get("category")?.toLowerCase()

// Filter posts by category
const filteredPosts = categoryParam
  ? posts.filter((post) => {
      return post.post_categories.some(
        (category) => category.toLowerCase() === categoryParam,
      )
    })
  : posts
---

<Layout title="Blog Posts">
  <Hero
    src="/images/landing_hero/landing_hero_bg.webp"
    alt="blog posts hero image"
    headerText="Blog Posts"
  />

  <BlogPostsSection
    posts={filteredPosts}
    headerText="Posts"
    isTextBlockHeader={true}
  />
</Layout>
