---
import Header from "../header/Header.astro"
import TextBlock from "../text_block/TextBlock.astro"
import Button from "../button/Button.astro"
import CloseDialogButton from "../button/CloseDialogButton.astro"

const {
  class: className,
  id,
  headerText,
  textBlockParagraphText,
  type, // "login" | "share" | "download" | "warning"
  dialogButtons = [], // single prop
} = Astro.props

let dialogType = type || "default"
---

<dialog
  class={`${className} fixed top-0 left-[50%] -translate-[50%] h-fit w-[80vw] px-4 py-4 max-w-[450px] rounded-md text-center
          transition-top duration-400 ease-in open:top-[50%] open:backdrop-blur-3xl focus:outline-0 focus:ring-0`}
  id={id}
>
  <!-- Global close button for every modal -->
  <CloseDialogButton />

  {
    dialogType === "login" ? (
      <>
        <div class="mt-12">
          <Header class="text-2xl font-bold" headerText={headerText} />
          <TextBlock textBlockParagraphText={textBlockParagraphText} />
          <div class="mt-12 mb-4 space-x-4">
            {dialogButtons.map((btn) => (
              <Button
                id={btn.id}
                href={btn.href}
                buttonText={btn.buttonText}
                isConfirmButton={true}
                class="bg-[var(--secondary-text-color)] text-white px-4 py-2 text-xl rounded-md transition-opacity duration-150 ease-in hover:opacity-90"
              />
            ))}
          </div>
        </div>
      </>
    ) : dialogType === "share" ? (
      <>
        <div class="grid place-content-center mx-auto py-8">
          <Header class="text-2xl font-bold" headerText={headerText} />
          <TextBlock textBlockParagraphText={textBlockParagraphText} />
        </div>
        <slot />
      </>
    ) : dialogType === "download" ? (
      <>
        <Header headerText={headerText} />
        <TextBlock textBlockParagraphText={textBlockParagraphText} />
        <slot />
      </>
    ) : dialogType === "warning" ? (
      <>
        <Header headerText={headerText} />
        <TextBlock textBlockParagraphText={textBlockParagraphText} />
        <div class="mt-8 flex justify-center gap-4">
          {dialogButtons.map((btn) => (
            <Button
              id={btn.id}
              data-post-id={btn.dataPostId}
              buttonText={btn.buttonText}
              isConfirmButton={true}
              class="px-4 py-2 text-lg rounded-md text-white bg-[var(--secondary-text-color)] hover:opacity-85 transition-opacity"
            />
          ))}
        </div>
      </>
    ) : (
      <>
        <Header headerText={headerText} />
        <TextBlock textBlockParagraphText={textBlockParagraphText} />
        <slot />
      </>
    )
  }
</dialog>

<style>
  dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
  }
</style>

<script>
  // Use event delegation so multiple modals work
  document.addEventListener("click", (e) => {
    if (e.target.closest(".close-modal-btn")) {
      const dialog = e.target.closest("dialog")
      dialog?.close()
    }
  })
</script>
<style>
  dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
  }
</style>

<script>
  // Close button logic
  document.querySelectorAll(".close-dialog-btn").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.stopPropagation()
      const dialog = e.currentTarget.closest("dialog")
      dialog?.close()
    })
  })
</script>
